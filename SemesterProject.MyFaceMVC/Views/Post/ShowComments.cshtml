@model PostWithCommentToAdd

@{
    ViewData["Title"] = "Comments";
}


<div class="col-12 border p-3 mt-3 bg-white">
    <div class="border border-success mb-2">
        @if (!string.IsNullOrEmpty(Model.Post.ImagePath))
        {
            var imagePath = $"/Image/{Model.Post.ImagePath}";
            <div class="col-12 border border-primary h-auto text-justify shadow-lg">@Model.Post.Text</div>
            <div class="col-12">
                <img src="@imagePath" width="300" />
            </div>
        }
        else
        {
            <div class="col-12 border-bottom border-primary h-auto text-justify bg-light py-2 shadow-lg">@Model.Post.Text</div>
        }
        <div class="btn-toolbar justify-content-between row col-12">

            <div class="mt-1 small pl-3 pt-1">@Model.Post.WhenAdded</div>

            <div class="btn-group bg-light">

                <button class="btn border" type="button">
                    <span class="badge badge-light btn"> <i class="far fa-thumbs-up fa-adjust"></i> @Model.Post.PostLikes.Count</span>
                </button>

            </div>
        </div>
    </div>
    <div class="my-4"></div>

    @foreach (var comment in Model.Post.PostComments)
    {
        <div class="container my-3 col-10">
            <div class="d-flex justify-content-between">
                <div class="form-group border mb-0 p-2">
                    @{
                        var currentUser = Model.Users.FirstOrDefault(x => x.Id == comment.FromWho);
                        <a asp-controller="Friends" asp-action="ViewProfile" asp-route-friendId="@currentUser.Id"> <span class="">@currentUser.FirstName @currentUser.LastName </span></a>
                    }
                    <span class="p-2">@comment.WhenAdded</span>
                </div>
            </div>

            <div class="input-group row col-12 mt-0">
                <div class="form-control border border-dark text-justify">@comment.Text</div>
                @if (ViewData["loggedUserId"].ToString() == comment.FromWho.ToString())
                {
                    <div class="input-group-append">
                        <form asp-action="EditComment" asp-route-userId="@ViewData["currentUserProfileId"]" asp-route-postId="@Model.Post.Id" asp-route-commentId="@comment.Id" method="post">
                            <button class="btn border">
                                <i class="fas fa-edit fa-align-center"></i>
                            </button>
                        </form>
                        <form asp-action="DeleteComment" asp-route-userId="@ViewData["currentUserProfileId"]" asp-route-postId="@Model.Post.Id" asp-route-commentId="@comment.Id" method="post">

                            <button class="btn btn-danger border" type="submit">
                                <i class="fas fa-trash-alt fa-adjust"></i>
                            </button>
                        </form>
                    </div>
                }
            </div>
        </div>

    }

    <form asp-action="AddComment" asp-route-userId="@ViewData["currentUserProfileId"]" asp-route-postId="@Model.Post.Id.ToString()" method="post" class="container col-10">
        <div class="input-group">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <textarea class="form-control" type="text" asp-for="@Model.Text" rows="1" style="height:3em;" id="text"></textarea>

            <span asp-validation-for="@Model.Text" class="text-danger"></span>

            <div class="input-group-append">
                <button type="submit" class="btn btn-sm btn-success"><i class="fas fa-plus"></i></button>
            </div>
        </div>
    </form>
</div>